<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Auto Image Circle</title>

	<!-- TODO Add a auto refresh after a certain period of time -->
	<!-- TOOD Add Caduceus monitoring -->

	<style type="text/css">
        #bg {
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
        }
        #bg img {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            min-width: 50%;
            min-height: 50%;
        }
    </style>
</head>
<body>

<div id="bg">
    <img src="img/initial-background.png" alt="">
</div>

<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript">
    $(function () {
        var fetchConfig = function () {
            var jqXHR = $.getJSON("config.json", function (data) {
                //console.log("Got a new configuration " + data.images.length);
                images = data.images;
            });
            return jqXHR;
        }

        var images = [];
        var imgElem = $('#bg img')
        var indexOfCurrentImage = 0;

        var displayImage = function () {
            imgElem.fadeOut('slow', function () {
                var indexOfNextImage = indexOfCurrentImage + 1 < images.length ? indexOfCurrentImage + 1 : 0;

                // Renew config
                if (indexOfNextImage === 0) {
                    fetchConfig();
                }

                var url = images[indexOfNextImage];
                imgElem.attr('src', url); 
                
                // TODO Wait with fadeIn until new image is loaded
                imgElem.fadeIn('slow');
                indexOfCurrentImage = indexOfNextImage;
            });
        };

        // Initial fetch of the configuration and after success, starting the image circle
        fetchConfig().success(function () {
            window.setInterval(displayImage, 12000);
        });
    });
</script>
</body>
</html>